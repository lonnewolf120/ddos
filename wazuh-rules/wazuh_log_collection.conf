<!--
  Wazuh Log Collection Configuration for DDoS Detection
  Deploy to: /var/ossec/etc/ossec.conf (inside <ossec_config> tags)

  This configuration enables monitoring of:
  1. Firewall/iptables logs (for packet-level detection)
  2. Web server logs (Apache/Nginx)
  3. Connection tracking logs
  4. Kernel logs
-->

<!-- ============================================================================
     FIREWALL LOG COLLECTION - CRITICAL FOR DDOS DETECTION
     ============================================================================ -->

<!-- Monitor iptables logs (if using separate log file) -->
<localfile>
  <log_format>syslog</log_format>
  <location>/var/log/iptables.log</location>
</localfile>

<!-- Monitor kernel logs (contains iptables/netfilter events) -->
<localfile>
  <log_format>syslog</log_format>
  <location>/var/log/kern.log</location>
</localfile>

<!-- Monitor system logs (fallback for iptables) -->
<localfile>
  <log_format>syslog</log_format>
  <location>/var/log/syslog</location>
</localfile>

<!-- Monitor messages (RHEL/CentOS) -->
<localfile>
  <log_format>syslog</log_format>
  <location>/var/log/messages</location>
</localfile>

<!-- ============================================================================
     WEB SERVER LOG COLLECTION - HTTP FLOOD DETECTION
     ============================================================================ -->

<!-- Apache Access Logs (bWAPP, DVWA on port 80/9080/9090) -->
<localfile>
  <log_format>apache</log_format>
  <location>/var/log/apache2/access.log</location>
</localfile>

<localfile>
  <log_format>apache</log_format>
  <location>/var/log/httpd/access_log</location>
</localfile>

<!-- Apache Error Logs (Slowloris detection) -->
<localfile>
  <log_format>apache</log_format>
  <location>/var/log/apache2/error.log</location>
</localfile>

<localfile>
  <log_format>apache</log_format>
  <location>/var/log/httpd/error_log</location>
</localfile>

<!-- Nginx Logs (if using Nginx) -->
<localfile>
  <log_format>syslog</log_format>
  <location>/var/log/nginx/access.log</location>
</localfile>

<localfile>
  <log_format>syslog</log_format>
  <location>/var/log/nginx/error.log</location>
</localfile>

<!-- ============================================================================
     CONNECTION TRACKING LOGS
     ============================================================================ -->

<!-- Monitor conntrack events (requires nfnetlink_log) -->
<localfile>
  <log_format>syslog</log_format>
  <location>/var/log/conntrack.log</location>
</localfile>

<!-- ============================================================================
     ENABLE IPTABLES LOGGING (Run on Blue Team servers)
     ============================================================================

     To enable iptables logging, run these commands on Blue Team servers:

     # Log all incoming traffic to monitored ports
     sudo iptables -I INPUT -p tcp --dport 80 -j LOG --log-prefix "IPTABLES_HTTP: " --log-level 4
     sudo iptables -I INPUT -p tcp --dport 443 -j LOG --log-prefix "IPTABLES_HTTPS: " --log-level 4
     sudo iptables -I INPUT -p tcp --dport 9080 -j LOG --log-prefix "IPTABLES_BWAPP: " --log-level 4
     sudo iptables -I INPUT -p tcp --dport 9090 -j LOG --log-prefix "IPTABLES_DVWA: " --log-level 4
     sudo iptables -I INPUT -p tcp --dport 3000 -j LOG --log-prefix "IPTABLES_JUICE: " --log-level 4

     # Log SYN packets from Red Team subnet
     sudo iptables -I INPUT -p tcp --tcp-flags SYN,ACK,FIN,RST SYN -s 10.10.30.0/24 -j LOG --log-prefix "REDTEAM_SYN: " --log-level 4
     sudo iptables -I INPUT -p tcp --tcp-flags SYN,ACK,FIN,RST SYN -s 10.72.200.61/32 -j LOG --log-prefix "REDTEAM_SYN: " --log-level 4
     sudo iptables -I INPUT -p tcp --tcp-flags SYN,ACK,FIN,RST SYN -s 10.72.200.62/32 -j LOG --log-prefix "REDTEAM_SYN: " --log-level 4
     sudo iptables -I INPUT -p tcp --tcp-flags SYN,ACK,FIN,RST SYN -s 10.72.200.63/32 -j LOG --log-prefix "REDTEAM_SYN: " --log-level 4
     sudo iptables -I INPUT -p tcp --tcp-flags SYN,ACK,FIN,RST SYN -s 10.72.200.64/32 -j LOG --log-prefix "REDTEAM_SYN: " --log-level 4
     sudo iptables -I INPUT -p tcp --tcp-flags SYN,ACK,FIN,RST SYN -s 10.72.200.65/32 -j LOG --log-prefix "REDTEAM_SYN: " --log-level 4

     # Log UDP packets from Red Team
     sudo iptables -I INPUT -p udp -s 10.10.30.0/24 -j LOG --log-prefix "REDTEAM_UDP: " --log-level 4
     sudo iptables -I INPUT -p udp -s 10.72.200.61/32 -j LOG --log-prefix "REDTEAM_UDP: " --log-level 4
     sudo iptables -I INPUT -p udp -s 10.72.200.62/32 -j LOG --log-prefix "REDTEAM_UDP: " --log-level 4
     sudo iptables -I INPUT -p udp -s 10.72.200.64/32 -j LOG --log-prefix "REDTEAM_UDP: " --log-level 4
     sudo iptables -I INPUT -p udp -s 10.72.200.65/32 -j LOG --log-prefix "REDTEAM_UDP: " --log-level 4

     # Log ICMP packets from Red Team
     sudo iptables -I INPUT -p icmp -s 10.10.30.0/24 -j LOG --log-prefix "REDTEAM_ICMP: " --log-level 4
     sudo iptables -I INPUT -p icmp -s 10.72.200.61/32 -j LOG --log-prefix "REDTEAM_ICMP: " --log-level 4
     sudo iptables -I INPUT -p icmp -s 10.72.200.62/32 -j LOG --log-prefix "REDTEAM_ICMP: " --log-level 4
     sudo iptables -I INPUT -p icmp -s 10.72.200.64/32 -j LOG --log-prefix "REDTEAM_ICMP: " --log-level 4
     sudo iptables -I INPUT -p icmp -s 10.72.200.65/32 -j LOG --log-prefix "REDTEAM_ICMP: " --log-level 4

     # Make iptables rules persistent
     sudo apt-get install iptables-persistent
     sudo netfilter-persistent save

     ============================================================================ -->
